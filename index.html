<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Explorer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #1a1a1a; color: white; }
        .folder > div { cursor: pointer; padding: 5px; }
        .folder-content { display: none; padding-left: 15px; }
        .active { display: block !important; }
        .watchlist-item { display: flex; justify-content: space-between; padding: 5px 10px; }
    </style>
</head>
<body class="flex h-screen">
    
    <!-- Sidebar -->
    <div id="sidebar" class="w-64 bg-gray-900 text-white p-3 space-y-4">
        <h2 class="text-lg font-bold">üé¨ Movie Explorer</h2>
        <input id="search" type="text" placeholder="Search movies..." class="w-full p-2 rounded bg-gray-800 border-none text-white">
        
        <!-- Movie Folder List -->
        <div id="folder-list" class="mt-2"></div>

        <!-- Watchlist -->
        <h2 class="text-lg font-bold mt-4">‚≠ê Watchlist</h2>
        <div id="watchlist" class="space-y-2"></div>
    </div>

    <!-- Main Content -->
    <div class="flex-1 p-5 overflow-auto">
        <h1 class="text-2xl font-bold">Movies</h1>
        <div id="movies-container" class="mt-4"></div>
    </div>

    <script>
        const moviesJsonPath = "movies.json"; // Change this path if needed

        // Fetch movie data
        async function loadMovies() {
            const response = await fetch(moviesJsonPath);
            const data = await response.json();
            return data.movies;
        }

        // Convert movie list into a folder structure
        function buildMovieTree(movies) {
            const tree = {};
            movies.forEach(movie => {
                const pathParts = movie.path.split("\\");
                let current = tree;
                pathParts.forEach((part, index) => {
                    if (!current[part]) current[part] = index === pathParts.length - 1 ? [] : {};
                    if (index === pathParts.length - 1) current[part].push(movie);
                    current = current[part];
                });
            });
            return tree;
        }

        // Render folder structure
        function renderFolderTree(folder, parentElement) {
            Object.keys(folder).forEach(folderName => {
                const folderDiv = document.createElement("div");
                folderDiv.className = "folder";

                const titleDiv = document.createElement("div");
                titleDiv.innerHTML = "üìÇ " + folderName;
                titleDiv.onclick = () => contentDiv.classList.toggle("active");

                const contentDiv = document.createElement("div");
                contentDiv.className = "folder-content";

                if (Array.isArray(folder[folderName])) {
                    folder[folderName].forEach(movie => {
                        const movieDiv = document.createElement("div");
                        movieDiv.className = "p-2 hover:bg-gray-700 rounded";
                        movieDiv.innerHTML = `üé• ${movie.name} <button class="ml-2 text-yellow-400" onclick="addToWatchlist('${movie.name}')">‚≠ê</button>`;
                        contentDiv.appendChild(movieDiv);
                    });
                } else {
                    renderFolderTree(folder[folderName], contentDiv);
                }

                folderDiv.appendChild(titleDiv);
                folderDiv.appendChild(contentDiv);
                parentElement.appendChild(folderDiv);
            });
        }

        // Add movie to watchlist (localStorage)
        function addToWatchlist(movieName) {
            let watchlist = JSON.parse(localStorage.getItem("watchlist")) || [];
            if (!watchlist.includes(movieName)) watchlist.push(movieName);
            localStorage.setItem("watchlist", JSON.stringify(watchlist));
            renderWatchlist();
        }

        // Remove movie from watchlist
        function removeFromWatchlist(movieName) {
            let watchlist = JSON.parse(localStorage.getItem("watchlist")) || [];
            watchlist = watchlist.filter(m => m !== movieName);
            localStorage.setItem("watchlist", JSON.stringify(watchlist));
            renderWatchlist();
        }

        // Display watchlist
        function renderWatchlist() {
            const watchlistContainer = document.getElementById("watchlist");
            watchlistContainer.innerHTML = "";
            let watchlist = JSON.parse(localStorage.getItem("watchlist")) || [];

            watchlist.forEach(movie => {
                const movieItem = document.createElement("div");
                movieItem.className = "watchlist-item bg-gray-800 rounded p-2";
                movieItem.innerHTML = `
                    ${movie}
                    <button class="text-red-400" onclick="removeFromWatchlist('${movie}')">‚ùå</button>
                `;
                watchlistContainer.appendChild(movieItem);
            });
        }

        // Search functionality
        document.getElementById("search").addEventListener("input", function() {
            const query = this.value.toLowerCase();
            const allMovies = document.querySelectorAll(".folder-content div");
            allMovies.forEach(movie => {
                movie.style.display = movie.innerText.toLowerCase().includes(query) ? "block" : "none";
            });
        });

        // Load and render movies
        (async function init() {
            const movies = await loadMovies();
            const movieTree = buildMovieTree(movies);
            renderFolderTree(movieTree, document.getElementById("folder-list"));
            renderWatchlist();
        })();
    </script>
</body>
</html>
